<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="GroceryOrderingApp.Mobile.Views.CustomerProductPage"
             Title="Products"
             BackgroundColor="{StaticResource BackgroundColor}">
    
    <Grid RowDefinitions="Auto,*,Auto" VerticalOptions="FillAndExpand">
        
        <!-- Header -->
        <StackLayout Grid.Row="0" BackgroundColor="{StaticResource Primary}" Padding="20" Spacing="0">
            <Label Text="ðŸ¥¬ Products" Style="{StaticResource HeadlineStyle}" 
                   TextColor="White" HorizontalTextAlignment="Center"/>
            <Label Text="Fresh items available for delivery" 
                   FontSize="12" TextColor="{StaticResource TextSecondary}" 
                   HorizontalTextAlignment="Center" Margin="0,8,0,0"/>
        </StackLayout>
        
        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="1" 
                          IsRunning="{Binding IsLoading}" 
                          IsVisible="{Binding IsLoading}"
                          Color="{StaticResource Primary}"
                          Scale="1.8"
                          VerticalOptions="Center"/>
        
        <!-- Products Grid -->
        <CollectionView Grid.Row="1" 
                       ItemsSource="{Binding Products}"
                       Padding="12"
                       VerticalOptions="FillAndExpand"
                       IsVisible="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" 
                                HorizontalItemSpacing="12" 
                                VerticalItemSpacing="12" 
                                Columns="2"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame Style="{StaticResource CardStyle}" 
                           HasShadow="True" 
                           BorderColor="{StaticResource Secondary}"
                           Padding="0">
                        <Grid RowDefinitions="80,Auto,Auto,Auto" Padding="12" RowSpacing="8">
                            
                            <!-- Product Image Placeholder -->
                            <Frame Grid.Row="0"
                                  CornerRadius="8"
                                  HasShadow="False"
                                  BackgroundColor="{StaticResource PrimaryLight}"
                                  Padding="0"
                                  BorderColor="{StaticResource PrimaryDark}">
                                <Label Text="ðŸ¥•" 
                                      FontSize="40" 
                                      HorizontalTextAlignment="Center"
                                      VerticalTextAlignment="Center"/>
                            </Frame>
                            
                            <!-- Product Name -->
                            <Label Grid.Row="1"
                                  Text="{Binding Name}"
                                  FontSize="13"
                                  FontAttributes="Bold"
                                  TextColor="{StaticResource TextPrimary}"
                                  LineBreakMode="TailTruncation"/>
                            
                            <!-- Price & Stock -->
                            <Grid Grid.Row="2"
                                 ColumnDefinitions="*,Auto"
                                 ColumnSpacing="8">
                                <Label Grid.Column="0"
                                      Text="{Binding Price, StringFormat='â‚¹{0:F2}'}"
                                      FontSize="14"
                                      FontAttributes="Bold"
                                      TextColor="{StaticResource Success}"/>
                                <Label Grid.Column="1"
                                      Text="{Binding StockQuantity, StringFormat='({0} left)'}"
                                      FontSize="10"
                                      TextColor="{StaticResource TextHint}"/>
                            </Grid>
                            
                            <!-- Add to Cart Button -->
                            <Button Grid.Row="3"
                                   Text="Add to Cart"
                                   Style="{StaticResource PrimaryButtonStyle}"
                                   FontSize="11"
                                   Padding="8"
                                   Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.AddToCartCommand}"
                                   CommandParameter="{Binding .}"/>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        
        <!-- Error Message -->
        <Label Grid.Row="1"
               Text="{Binding ErrorMessage}"
               TextColor="{StaticResource Error}"
               FontSize="14"
               LineBreakMode="WordWrap"
               Padding="20"
               HorizontalTextAlignment="Center"
               VerticalOptions="Center"
               IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBool}}"/>
        
        <!-- Footer with help text -->
        <Label Grid.Row="2"
               Text="Tap 'Add to Cart' and select quantity"
               FontSize="11"
               TextColor="{StaticResource TextHint}"
               HorizontalTextAlignment="Center"
               Margin="0,12,0,12"/>
    </Grid>
    
</ContentPage>
